import{a as ee,b as be,c as Y,u as v,r as l,n as te,d as E,t as W,l as j,s as A,e as ne,j as c,f as d,g as w,R as $,h as ve,F as M,i as Ce,k as se,m as H,G as xe,o as F,P as Se,v as Ae,p as De,q as ke}from"./vendor.36d518d7.js";const _e=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}};_e();const oe=ee(!1),G=be("as","host",{replaceState:!0,serialize:e=>e,deserialize:e=>e==="host"?"host":"guest"}),re=Y([]),Be=()=>E(re),S=()=>{const e=v(re),n=s=>l.exports.useCallback(t=>{console[s==="info"||s==="success"?"log":s](t);const r=new Date,a=te();return e(i=>{i.unshift({message:t,timestamp:r,level:s,id:a})})},[]);return{info:n("info"),warn:n("warn"),error:n("error"),success:n("success")}},_=()=>{const e=E(G),n={main:"#282828",dark:"#000000",light:"#404040"},s={main:"#81d4fa",light:"#b6ffff",dark:"#4ba3c7",text:"#202020"},t={main:"#ffee58",light:"#ffff8b",dark:"#c9bc1f",text:"#202020"};return{color:{background:n,primary:e==="host"?s:t,secondary:e==="host"?t:s,text:"#E8E8E8"}}},K=(e,n,s,t,o)=>{"ontrack"in e?(t.info("set ontrack event"),e.ontrack=r=>{t.info("ontrack event detected");for(const a of r.streams){let i=new Audio;i.muted=!0,i.srcObject=a,i.addEventListener("canplaythrough",()=>{i=null}),n.createMediaStreamSource(a).connect(s),o(s.stream).then(()=>{t.info("update stream")})}}):(t.info("set onaddstream event"),e.onaddstream=r=>{t.info("onaddstream event detected");let a=new Audio;a.muted=!0,a.srcObject=r.stream,a.addEventListener("canplaythrough",()=>{a=null}),n.createMediaStreamSource(r.stream).connect(s),o(s.stream).then(()=>{t.info("update stream")})})},U=()=>{let e=()=>{};const n=new Promise(s=>{e=s});return[s=>e(s),()=>n]},Ee=W({type:j("acceptGuest"),guestId:A,others:ne(A)}),ae=W({type:j("offer"),from:A,to:A,sdp:A}),Re=W({type:j("acceptHost"),guestId:A,name:A,offers:ne(ae)}),ce=W({type:j("answer"),from:A,to:A,sdp:A}),Fe=(e,n,s,t)=>{const o=new Map,[r,a]=U();return n().then(async i=>{i.onmessage=async f=>{const u=JSON.parse(f.data);if(Ee.is(u)){t.info("accepted by host");const g=u.guestId;r(u.guestId);const h=[];for(const x of u.others){const b=new RTCPeerConnection({iceServers:[]});s(b),o.set(x,b),await b.setLocalDescription(await b.createOffer());const p=await new Promise(D=>{b.onicecandidate=C=>{!C.candidate&&b.localDescription&&D(b.localDescription.sdp)}});h.push({type:"offer",from:g,to:x,sdp:p})}const m={type:"acceptHost",guestId:g,offers:h,name:e};i.send(JSON.stringify(m))}if(ae.is(u)){t.info("received offer request");const g=await a(),h=new RTCPeerConnection({iceServers:[]});s(h),o.set(u.from,h),await h.setRemoteDescription({type:"offer",sdp:u.sdp}),await h.setLocalDescription(await h.createAnswer());const m=await new Promise(b=>{h.onicecandidate=p=>{!p.candidate&&h.localDescription&&b(h.localDescription.sdp)}}),x={type:"answer",from:g,to:u.from,sdp:m};i.send(JSON.stringify(x))}if(ce.is(u)){t.info("received answer");const g=o.get(u.from);if(g==null)return;await g.setRemoteDescription({type:"answer",sdp:u.sdp})}}}),{}},Pe=(e,n)=>(s,t)=>{if(Re.is(t)){n.info(`${t.guestId.slice(0,5)} / accepted by guest`);const o=e.get(t.guestId);if(o==null)return;o.setName(t.name);for(const r of t.offers){n.info(`${r.to.slice(0,5)} / sending offer`);const a=e.get(r.to);a!=null&&a.sendMessage(r)}}if(ce.is(t)){const o=e.get(t.to);if(n.info(`${t.to.slice(0,5)} / sending answer from ${t.from.slice(0,5)}`),o==null)return;o.sendMessage(t)}},Le=async(e,n,s)=>{const t=new Map,o=new AudioContext,r=o.createMediaStreamDestination(),a=await navigator.mediaDevices.getUserMedia({video:!1,audio:{echoCancellation:!0}});await e(r.stream);const i=()=>{const m=o.createOscillator();m.type="sine",m.frequency.value=440,m.connect(r),m.start()},f=Pe(t,n);return{createPeer:async()=>{const m=te(),[x,b]=U(),p=new RTCPeerConnection({iceServers:[]});p.onconnectionstatechange=()=>{n.info(`${m.slice(0,5)} / connection state change: ${p.connectionState}`),s()};const D=a.clone();p.addStream(D),K(p,o,r,n,e);const C=p.createDataChannel("host-to-guest"),[V,he]=U();C.onopen=()=>{n.info(`${m.slice(0,5)} / data channel established`),V(C)},C.onmessage=B=>{f(m,JSON.parse(B.data))},await p.setLocalDescription(await p.createOffer());const ye=await new Promise(B=>{p.onicecandidate=N=>{!N.candidate&&p.localDescription&&B(p.localDescription.sdp)}}),Z={id:m,sdp:ye,connect:async B=>{const N=new Promise(we=>{p.onconnectionstatechange=()=>{n.info(`${m.slice(0,5)} / connection state change: ${p.connectionState}`),s(),p.connectionState==="connected"&&we()}});return await p.setRemoteDescription({type:"answer",sdp:B}),N},close:()=>{p.close(),t.delete(m),s()},getConnectionState:()=>p.connectionState,sendMessage:async B=>{(await he()).send(JSON.stringify(B))},data:C,setName:x,getName:b};return t.set(m,Z),Z},getPeer:m=>t.get(m),getPeers:()=>t,oscillateLocal:i}},R=Y([]),ie=ee({}),Te=()=>{const e=v(ie);return l.exports.useCallback(()=>{e(Symbol())},[])},Ie=()=>{E(ie)},Me=({setService:e,setCurrentPeer:n,playAudio:s})=>{const{color:t}=_(),o=v(oe),r=v(R),a=S(),i=Te();return c("div",{css:d({display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}),children:c("button",{type:"button",css:d({padding:"0.5rem 1rem",outline:"none",border:"none",background:t.primary.main,color:t.primary.text,fontSize:"1.5rem",width:"14rem"}),onClick:async()=>{const f=await Le(s,a,i),u=await f.createPeer();e(f),o(!0),n(u),r(g=>{g.push({stage:1,sdp:u.sdp})})},children:"\u63A5\u7D9A\u958B\u59CB"})})},ue=({audioRef:e})=>c("div",{children:c("audio",{autoPlay:!0,ref:e})});let y,le=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});le.decode();let q=null;function P(){return(q===null||q.buffer!==y.memory.buffer)&&(q=new Uint8Array(y.memory.buffer)),q}function X(e,n){return le.decode(P().subarray(e,e+n))}let L=0,z=new TextEncoder("utf-8");const Oe=typeof z.encodeInto=="function"?function(e,n){return z.encodeInto(e,n)}:function(e,n){const s=z.encode(e);return n.set(s),{read:e.length,written:s.length}};function Ne(e,n,s){if(s===void 0){const i=z.encode(e),f=n(i.length);return P().subarray(f,f+i.length).set(i),L=i.length,f}let t=e.length,o=n(t);const r=P();let a=0;for(;a<t;a++){const i=e.charCodeAt(a);if(i>127)break;r[o+a]=i}if(a!==t){a!==0&&(e=e.slice(a)),o=s(o,t,t=a+e.length*3);const i=P().subarray(o+a,o+t);a+=Oe(e,i).written}return L=a,o}let Q=null;function T(){return(Q===null||Q.buffer!==y.memory.buffer)&&(Q=new Int32Array(y.memory.buffer)),Q}function We(e,n){return P().subarray(e/1,e/1+n)}function je(e){try{const r=y.__wbindgen_add_to_stack_pointer(-16);var n=Ne(e,y.__wbindgen_malloc,y.__wbindgen_realloc),s=L;y.compress(r,n,s);var t=T()[r/4+0],o=T()[r/4+1];let a;return t!==0&&(a=We(t,o).slice(),y.__wbindgen_free(t,o*1)),a}finally{y.__wbindgen_add_to_stack_pointer(16)}}function de(e,n){const s=n(e.length*1);return P().set(e,s/1),L=e.length,s}function $e(e,n){try{const a=y.__wbindgen_add_to_stack_pointer(-16);var s=de(e,y.__wbindgen_malloc),t=L;y.into_svg(a,s,t,n);var o=T()[a/4+0],r=T()[a/4+1];let i;return o!==0&&(i=X(o,r).slice(),y.__wbindgen_free(o,r*1)),i}finally{y.__wbindgen_add_to_stack_pointer(16)}}function fe(e){try{const r=y.__wbindgen_add_to_stack_pointer(-16);var n=de(e,y.__wbindgen_malloc),s=L;y.inflate(r,n,s);var t=T()[r/4+0],o=T()[r/4+1];let a;return t!==0&&(a=X(t,o).slice(),y.__wbindgen_free(t,o*1)),a}finally{y.__wbindgen_add_to_stack_pointer(16)}}async function He(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(t){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const s=await e.arrayBuffer();return await WebAssembly.instantiate(s,n)}else{const s=await WebAssembly.instantiate(e,n);return s instanceof WebAssembly.Instance?{instance:s,module:e}:s}}async function pe(e){typeof e=="undefined"&&(e=new URL("/qr-webrtc/assets/wasm_bg.8832fa6e.wasm",self.location));const n={};n.wbg={},n.wbg.__wbg_alert_f5393de24ed74e50=function(o,r){alert(X(o,r))},(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:s,module:t}=await He(await e,n);return y=s.exports,pe.__wbindgen_wasm_module=t,y}const ge=({src:e,cacheKey:n})=>{const s=l.exports.useRef({}),t=S(),o=l.exports.useMemo(()=>{const r=s.current[n];if(r)return r;const a=$e(e,300);return a===void 0?(t.error("QR Code creation failed for some reason."),""):(s.current[n]=a,a)},[e,n]);return l.exports.useEffect(()=>{console.log(`${n} generate:`),console.log(e)},[e,n]),c("div",{dangerouslySetInnerHTML:{__html:o}})},I=({backTitle:e,nextTitle:n,onBack:s,onNext:t})=>{const{color:o}=_();return w("ul",{css:d({display:"grid",gridTemplateColumns:"50% 50%",width:"100%",padding:"2rem",gap:"1rem",maxWidth:"400px"}),children:[e!=null&&c("li",{children:c("button",{type:"button",css:d({width:"100%",height:"2rem",border:"none",outline:"none",background:o.primary.main}),onClick:s,children:e})}),n&&c("li",{css:d({display:"flex",justifyContent:"center",alignItems:"center"}),children:c("button",{type:"button",css:d({width:"100%",height:"2rem",border:"none",outline:"none",background:o.primary.main}),onClick:t,children:n})})]})},k=({title:e,children:n})=>w("section",{css:d({display:"flex",flexWrap:"wrap",justifyContent:"center",width:"100%",padding:"1rem"}),children:[c("h2",{css:d({width:"100%",marginBottom:"1rem",fontSize:"larger"}),children:e}),n]}),me=(e,n,s,t,o)=>{const r=l.exports.useMemo(()=>{const a=je(e);if(a==null){s.error("Failed to compress sdp.");return}return new Uint8Array(a)},t);return l.exports.useMemo(()=>r==null?void 0:n===1?r.subarray(0,r.length/2):r.subarray(r.length/2),o)},Ge=$.memo(function({stage:n}){const s=v(R),[t,o]=l.exports.useState(1),r=S(),a=l.exports.useCallback(()=>{t===2?o(1):s(()=>[{stage:5}])},[t]),i=l.exports.useCallback(()=>{t===1?o(2):s(g=>{g.push({stage:2})})},[t]),f=t===1?"1.\u30AA\u30D5\u30A1\u30FC(\u524D\u534A)":"1.\u30AA\u30D5\u30A1\u30FC(\u5F8C\u534A)",u=me(n.sdp,t,r,[n],[n,t]);return w(k,{title:f,children:[u&&c("div",{css:d({display:"flex",justifyContent:"center",width:"100%",marginBottom:"1rem"}),children:c(ge,{src:u,cacheKey:`host-offer-${t}`})}),c("p",{css:d({width:"100%",fontFamily:"monospace",paddingLeft:"1rem"}),children:c("span",{children:"\u63A5\u7D9A\u3059\u308B\u30B2\u30B9\u30C8\u306B\u63D0\u793A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"})}),t===2&&c("p",{css:d({width:"100%",fontFamily:"monospace",paddingLeft:"1rem"}),children:"\u300C\u6B21\u3078\u300D\u3092\u62BC\u3059\u3068\u30AB\u30E1\u30E9\u304C\u8D77\u52D5\u3057\u307E\u3059\u3002"}),c(I,{backTitle:t===2?"\u623B\u308B":"\u30B2\u30B9\u30C8\u4E00\u89A7",nextTitle:"\u6B21\u3078",onBack:a,onNext:i})]})}),J=({onResult:e})=>{const n=l.exports.useRef(null),s=S();return l.exports.useEffect(()=>{const o=(async()=>{const r=document.createElement("video"),a=n.current;if(a==null){s.error("Failed to get canvas element.");return}const i=a.getContext("2d");if(i==null){s.error("Failed to get canvas context");return}const f=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:640},height:{ideal:480}}});return r.srcObject=f,await r.play(),requestAnimationFrame(function g(){const h=n.current;if(h==null||r.readyState!==r.HAVE_ENOUGH_DATA)return;h.width=r.videoWidth,h.height=r.videoHeight,i.drawImage(r,0,0,h.width,h.height);const m=i.getImageData(0,0,h.width,h.height),x=ve(m.data,m.width,m.height,{inversionAttempts:"dontInvert"});if(!x){requestAnimationFrame(g);return}e(x),f.getTracks().forEach(b=>{b.readyState==="live"&&b.stop()})}),f})().catch(r=>{s.error(`Cannot get video stream: ${String(r)}`)});return()=>{o.then(r=>{r&&r.getTracks().forEach(a=>{a.readyState==="live"&&a.stop()})})}},[]),c("div",{children:c("canvas",{ref:n})})},Ue=()=>{const[e,n]=l.exports.useState(void 0),s=v(R),t=l.exports.useCallback(a=>{console.log("answer1 received:"),console.log(a.binaryData),n(a.binaryData)},[]),o=l.exports.useCallback(()=>{s(a=>{a.pop()})},[]),r=l.exports.useCallback(()=>{e!=null&&s(a=>{a.push({stage:3,halfAnswer:e})})},[e]);return w(k,{title:"2.\u30A2\u30F3\u30B5\u30FC\u53D7\u4FE1(\u524D\u534A)",children:[e==null&&c(J,{onResult:t}),c(I,{backTitle:"\u623B\u308B",onBack:o,nextTitle:e!=null?"\u6B21\u3078":void 0,onNext:r})]})},qe=({stage:e})=>{const[n,s]=l.exports.useState(void 0),t=v(R),o=S(),r=l.exports.useCallback(i=>{console.log("answer2 received:"),console.log(i.binaryData);const f=fe(new Uint8Array([...e.halfAnswer.slice(5),...i.binaryData.slice(5)]));f!=null?(s(f),t(u=>{u.push({stage:4,sdp:f})})):o.error("Decoding SDP Failed")},[]),a=l.exports.useCallback(()=>{t(i=>{s(void 0),i.pop()})},[]);return w(k,{title:"3.\u30A2\u30F3\u30B5\u30FC\u53D7\u4FE1(\u5F8C\u534A)",children:[n==null&&c(J,{onResult:r}),c(I,{backTitle:"\u623B\u308B",onBack:a})]})},ze=({stage:e,peer:n,service:s})=>{const t=S(),o=v(R);return l.exports.useEffect(()=>{(async()=>{await n.connect(e.sdp);const a={type:"acceptGuest",guestId:n.id,others:Array.from(s.getPeers().keys()).filter(i=>i!==n.id)};await n.sendMessage(a),o(()=>[{stage:5}])})().catch(a=>{t.error(`Failed to receive answer: ${String(a)}`)})},[]),c(k,{title:"4. \u63A5\u7D9A\u4E2D",children:c("p",{children:"\u63A5\u7D9A\u4E2D\u3067\u3059..."})})},Qe=({textP:e})=>{const[n,s]=l.exports.useState(void 0);return l.exports.useEffect(()=>{e.then(t=>{s(t)})},[]),c(M,{children:n!=null?n:""})},Je=({service:e})=>{const n=e.getPeers(),s=v(R);Ie();const{color:t}=_();return l.exports.useEffect(()=>{for(const o of n.values())o.getConnectionState()!=="connected"&&o.close()},[]),c(k,{title:"\u30B2\u30B9\u30C8\u4E00\u89A7",children:w("div",{children:[n.size===0&&c("p",{css:d({marginBottom:"5rem"}),children:"\u307E\u3060\u63A5\u7D9A\u306F\u3042\u308A\u307E\u305B\u3093\u3002"}),c("div",{css:d({display:"flex",justifyContent:"center"}),children:c("button",{type:"button",css:d({border:"none",outline:"none",padding:"0.5rem 1rem",background:t.primary.main}),onClick:async()=>{const o=await e.createPeer();s(()=>[{stage:1,sdp:o.sdp}])},children:"\u65B0\u898F\u63A5\u7D9A"})}),n.size>0&&c("ol",{css:d({display:"flex",flexWrap:"wrap",padding:"1rem",width:"100%"}),children:[...n.values()].map(o=>w("li",{css:d({display:"flex",justifyContent:"space-between",width:"100%"}),children:[c("span",{css:d({marginRight:"1rem"}),children:o.id.slice(0,6)}),c("span",{css:d({marginRight:"1rem"}),children:c(Qe,{textP:o.getName()})}),c("span",{children:o.getConnectionState()}),c("button",{type:"button",css:d({border:"none",outline:"none",width:"2rem",background:t.secondary.dark}),onClick:()=>{o.close()},children:"\xD7"})]},o.id))})]})})},Ve=({service:e,peer:n})=>{const s=E(R),t=s[s.length-1];return t==null?null:t.stage===1?c(Ge,{stage:t}):t.stage===2?c(Ue,{}):t.stage===3?c(qe,{stage:t}):t.stage===4?c(ze,{service:e,stage:t,peer:n}):t.stage===5?c(Je,{service:e}):c(M,{})},Ye=()=>{const[e,n]=l.exports.useState(),[s,t]=l.exports.useState(),o=S(),r=l.exports.useRef(null),a=l.exports.useCallback(async i=>{if(r.current==null){o.warn("ignore playAudio() since no audio element found.");return}r.current.srcObject=i,await r.current.play(),r.current.volume=1},[]);return w("main",{css:d({width:"100%",height:"100%",maxWidth:1200}),children:[!e&&c(Me,{setService:n,setCurrentPeer:t,playAudio:a}),e&&s!=null&&c(Ve,{service:e,peer:s}),c(ue,{audioRef:r})]})},Ke=async(e,n,s)=>{const t=new AudioContext,o=t.createMediaStreamDestination(),r=await navigator.mediaDevices.getUserMedia({video:!1,audio:{echoCancellation:!0}});await e(o.stream);const[a,i]=U(),u=await(async()=>{const p=new RTCPeerConnection({iceServers:[]}),D=r.clone();return p.ondatachannel=C=>{n.info("data channel established"),a(C.channel)},p.addStream(D),K(p,t,o,n,e),p})(),g=async p=>{await u.setRemoteDescription({type:"offer",sdp:p});const D=await u.createAnswer();return await u.setLocalDescription(D),new Promise(C=>{u.onicecandidate=V=>{!V.candidate&&u.localDescription!=null&&C(u.localDescription.sdp)}})},h=p=>{u.onconnectionstatechange=()=>{u.connectionState==="connected"&&(n.info("connected to host"),p())}},x=Fe(s,i,p=>{const D=r.clone();for(const C of D.getTracks())p.addTrack(C);K(p,t,o,n,e)},n);return{host:u,createAnswer:g,setOnConnect:h,close:()=>u.close(),signalService:x}},Xe=Ce("guestName","\u306A\u306A\u3057\u3055\u3093"),O=Y([{stage:1}]),Ze=({setService:e,playAudio:n})=>{const s=S(),{color:t}=_(),[o,r]=se(Xe);return c("div",{css:d({display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}),children:w("div",{css:d({width:"100%",padding:"2rem"}),children:[c("div",{css:d({display:"flex",width:"100%",justifyContent:"center",marginBottom:"3rem"}),children:c("input",{type:"text",css:d({outline:"none",border:"none",fontSize:"1rem",padding:"0.25rem 0.5rem",height:"3rem",width:"14rem"}),onChange:a=>{r(a.target.value)},value:o})}),c("div",{css:d({display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}),children:c("button",{type:"button",css:d({padding:"0.5rem 1rem",outline:"none",border:"none",background:t.primary.main,color:t.primary.text,fontSize:"1.5rem",width:"14rem"}),onClick:async()=>{const a=await Ke(n,s,o);e(a)},children:"\u63A5\u7D9A\u958B\u59CB"})})]})})},et=()=>{const[e,n]=l.exports.useState(void 0),s=v(O),t=l.exports.useCallback(r=>{console.log("offer1 received:"),console.log(r.binaryData),n(r.binaryData)},[]),o=l.exports.useCallback(()=>{e!=null&&s(r=>{r.push({stage:2,halfOffer:e})})},[e]);return w(k,{title:"1.\u30AA\u30D5\u30A1\u30FC\u53D7\u4FE1(\u524D\u534A)",children:[e==null&&c(J,{onResult:t}),e&&c(I,{nextTitle:"\u6B21\u3078",onNext:o})]})},tt=({stage:e,service:n})=>{const[s,t]=l.exports.useState(void 0),o=v(O),r=l.exports.useCallback(async i=>{console.log("offer2 received:"),console.log(i.binaryData);const f=fe(new Uint8Array([...e.halfOffer.slice(5),...i.binaryData.slice(5)]));if(console.log(f),t(f),f!=null){t(f);const u=await n.createAnswer(f);o(g=>{g.push({stage:3,sdp:u})})}},[]),a=l.exports.useCallback(()=>{t(void 0),o(i=>{i.pop()})},[]);return w(k,{title:"2.\u30AA\u30D5\u30A1\u30FC\u53D7\u4FE1(\u5F8C\u534A)",children:[s==null&&c(J,{onResult:r}),c(I,{backTitle:"\u623B\u308B",onBack:a})]})},nt=({stage:e,service:n})=>{const s=v(O),[t,o]=l.exports.useState(1),r=S(),a=t===1?"3.\u30A2\u30F3\u30B5\u30FC(\u524D\u534A)":"3.\u30A2\u30F3\u30B5\u30FC(\u5F8C\u534A)",i=me(e.sdp,t,r,[e],[e,t]),f=l.exports.useCallback(()=>{t===1&&o(2)},[]),u=l.exports.useCallback(()=>{if(t===2){o(1);return}s(g=>{g.pop(),g.pop()})},[]);return l.exports.useLayoutEffect(()=>{n.setOnConnect(()=>{s(g=>{g.push({stage:4})})})},[]),w(k,{title:a,children:[i&&c("div",{css:d({display:"flex",justifyContent:"center",width:"100%",marginBottom:"1rem"}),children:c(ge,{src:i,cacheKey:`guest-answer-${t}`})}),c("p",{css:d({width:"100%",fontFamily:"monospace",paddingLeft:"1rem"}),children:c("span",{children:`\u30DB\u30B9\u30C8\u306BQR\u30B3\u30FC\u30C9\u3092${t===2?"\u3082\u3046\u4E00\u5EA6":""}\u63D0\u793A\u3057\u3066\u304F\u3060\u3055\u3044\u3002`})}),c(I,{backTitle:"\u623B\u308B",nextTitle:t===1?"\u6B21\u3078":void 0,onNext:f,onBack:u})]})},st=()=>{const e=v(O);return l.exports.useEffect(()=>{e(()=>[{stage:5}])},[]),c(k,{title:"4. \u63A5\u7D9A\u4E2D",children:c("p",{children:"\u63A5\u7D9A\u4E2D\u3067\u3059..."})})},ot=({children:e})=>c("p",{css:d({fontSize:"smaller"}),children:e!=null?e:"This Component is not implemented yet."}),rt=({service:e})=>{const n=E(O),s=n[n.length-1];return s==null?null:s.stage===1?c(et,{}):s.stage===2?c(tt,{stage:s,service:e}):s.stage===3?c(nt,{stage:s,service:e}):s.stage===4?c(st,{}):s.stage===5?c(ot,{}):c(M,{})},at=()=>{const e=l.exports.useRef(null),n=S(),[s,t]=l.exports.useState(void 0),o=l.exports.useCallback(async r=>{if(e.current==null){n.warn("ignore playAudio() since no audio element found.");return}e.current.srcObject=r,await e.current.play(),e.current.volume=1},[]);return w("main",{css:d({width:"100%",height:"100%",maxWidth:1200}),children:[s==null&&c(Ze,{setService:t,playAudio:o}),s&&c(rt,{service:s}),c(ue,{audioRef:e})]})},ct=()=>{const[e,n]=se(G),s=E(oe),t=S(),{color:o}=_(),r=e==="host"?"\u30DB\u30B9\u30C8":"\u30B2\u30B9\u30C8",a=e==="host"?"\u30B2\u30B9\u30C8":"\u30DB\u30B9\u30C8";return c("button",{className:H({started:s}),css:d({width:"9rem",border:"none",outline:"none",padding:"0.125rem 0.5rem",background:`linear-gradient(135deg, ${o.primary.main} 50%, ${o.secondary.main} 50%)`,color:o.primary.text,"&.started":{background:o.background.dark,color:o.text}}),type:"button",onClick:()=>{if(s){t.warn("\u30BB\u30C3\u30B7\u30E7\u30F3\u304C\u958B\u59CB\u3055\u308C\u3066\u3044\u307E\u3059\u3002\u30E2\u30FC\u30C9\u3092\u5909\u66F4\u3067\u304D\u307E\u305B\u3093\u3002");return}n(i=>i==="host"?"guest":"host")},disabled:s,children:s?c("span",{children:r}):w(M,{children:[c("span",{css:d({fontWeight:"bolder"}),children:`[${r}]`})," \u21D2 ",c("span",{children:a})]})})},it=()=>{const{color:e}=_(),[n,s]=l.exports.useState("");return l.exports.useEffect(()=>{const t=Array.from(document.getElementsByTagName("script"));for(const o of t){const r=/index\.([^.]+)\.js$/.exec(o.src);if(r){s(r[1]);break}}},[]),w("header",{css:d({display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%",paddingLeft:"0.5rem",paddingRight:"1rem",background:e.background.light}),children:[w("span",{children:["QR WebRTC$",n?` ${n}`:""]}),c(ct,{})]})},ut=$.memo(function({item:n}){const{timestamp:s,level:t,message:o}=n,a=`${[s.getHours(),s.getMinutes(),s.getSeconds()].map(i=>i.toString(10).padStart(2,"0")).join(":")} [${t.toUpperCase()}] ${o}`;return c("li",{className:t,css:d({fontFamily:"monospace","&.info":{color:"#bdbdbd"},"&.warn":{color:"#ffa726"},"&.error":{color:"#ef5350"},"&.success":{color:"#29b6f6"}}),children:a})}),lt=$.memo(function({items:n}){return c("ul",{css:d({height:"100%",paddingLeft:"0.5rem"}),children:n.map(s=>c(ut,{item:s},s.id))})}),dt=()=>{const[e,n]=l.exports.useState(!1),{color:s}=_(),t=Be(),o=t.length>0&&t[t.length-1].level==="error";return l.exports.useEffect(()=>{o&&n(!0)},[o]),w("footer",{className:H({open:e}),css:d({display:"grid",height:"1.5rem",gridTemplateRows:"1.5rem 1fr",overflow:"hidden",transition:"all 0.5s","&.open":{height:"12rem"},background:s.background.dark,color:s.text}),children:[w("button",{type:"button",className:H({error:o}),css:d({display:"flex",justifyContent:"right",alignItems:"center",width:"100%",height:"100%",paddingRight:"1rem",border:"none",outline:"none",background:s.background.dark,color:s.text,"&.error":{background:"#b61827"}}),onClick:()=>n(r=>!r),children:[c("span",{css:d({marginRight:"0.75rem"}),children:"\u30ED\u30B0"}),c("span",{className:H({open:e}),css:d({display:"inline-block",height:"0.75rem",width:"0.75rem",borderLeft:"0.375rem solid transparent",borderBottom:"0.75rem solid white",borderRight:"0.375rem solid transparent",transition:"all 0.5s","&.open":{transform:"rotate(-180deg)"}})})]}),c("div",{css:d({height:"100%",overflowY:"scroll",borderTop:`1px solid ${s.primary.dark}`,scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),children:c(lt,{items:t})})]})},ft=({children:e})=>{const{color:n}=_();return w(M,{children:[w("div",{css:d({display:"grid",width:"100%",height:"100vh",gridTemplateRows:"2.5rem 1fr auto"}),children:[c("div",{css:d({height:"100%"}),children:c(it,{})}),c("div",{css:d({height:"100%",display:"flex",justifyContent:"center"}),children:e}),c("div",{css:d({height:"100%"}),children:c(dt,{})})]}),c(xe,{styles:d({"*":{boxSizing:"border-box",margin:0,padding:0},"ul, ol":{margin:0,padding:0,listStyleType:"none"},body:{background:n.background.main,color:n.text,margin:0,padding:0}})})]})},pt=()=>{const e=E(G),n=v(G);return l.exports.useLayoutEffect(()=>{pe().catch(o=>{console.error(o)});const t=new URLSearchParams(window.location.hash.substring(1)).get("as")||"host";n(t==="host"?"host":"guest")},[]),F(ft,{children:e==="host"?F(Ye,{}):F(at,{})})},gt=({children:e})=>c(Se,{children:e});function mt(e={}){const{immediate:n=!1,onNeedRefresh:s,onOfflineReady:t,onRegistered:o,onRegisterError:r}=e;let a,i;const f=async(u=!0)=>{u&&(a==null||a.addEventListener("controlling",g=>{g.isUpdate&&window.location.reload()})),i&&i.waiting&&await De(i.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){a=new Ae("/qr-webrtc/sw.js",{scope:"/qr-webrtc/"}),a.addEventListener("activated",u=>{u.isUpdate||t==null||t()});{const u=()=>{s==null||s()};a.addEventListener("waiting",u),a.addEventListener("externalwaiting",u)}a.register({immediate:n}).then(u=>{i=u,o==null||o(u)}).catch(u=>{r==null||r(u)})}return f}mt();ke.render(F($.StrictMode,{children:F(gt,{children:F(pt,{})})}),document.getElementById("root"));
